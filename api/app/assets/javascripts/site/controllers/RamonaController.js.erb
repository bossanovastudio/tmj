tmj.controller('RamonaController', function($rootScope, $scope, $http, $sce, $compile, $routeParams) {

    $rootScope.pageName = 'ramona';

    var distanceTop = 0;

    $scope.following = false;
    $scope.currentUser = {};

    $http.get('/api/user/ramona/profile.json', {
        headers: {
            'Content-Type': 'application/json',
            'X-User-username': storage.get('user') ? storage.get('user').username : '',
            'X-User-token': storage.get('user') ? storage.get('user').authentication_token : '',
        }
    })
    .then(function(response) {
        $scope.currentUser.bio = response.data.bio;
        $scope.currentUser.username = response.data.username;
        $scope.currentUser.image = response.data.image;
        setTimeout(function() {
            $('.avatar').css('background-image', "url("+$scope.currentUser.image+")");
        }, 1000);
        setTimeout(function() {
          $('.recommendcounter').css('opacity', '1');
          $('.recommendcounter').each(function () {
              $(this).prop('Counter',0).animate({
                  Counter: $(this).text()
              }, {
                  duration: 4000,
                  easing: 'swing',
                  step: function (now) {
                      $(this).text(Math.ceil(now));
                  }
              });
          });
        }, 2600);
    }, function(response) {
        window.location = '/';
    });

    $scope.swipeUp = function() {
        if ($('.cards .card').length == 0) {
            return false;
        }
        distanceTop = -$(window).height();
        $('.cards').each(function(i, e) {
            var top = parseInt($(this).css('top').replace('px'));
            if (i == 0 && top == (($('.cards').length - 1) * distanceTop)) {
                distanceTop = 0;
            }
            $(this).animate({ top: top + distanceTop }, 500, 'easeOutExpo');
        });
        setTimeout(function() {
            $rootScope.animateInitial();
        }, 1000);
        $rootScope.track('swipe', 'cards', 'up');

        $('.arrowBottom').fadeOut();
    }

    $scope.followUser = function() {
        if (!storage.get('user')) {
            window.location = '/login';
        } else {
            $http.get('/api/ramona/follow.json', {
                headers: {
                    'Content-Type': 'application/json',
                    'X-User-username': storage.get('user').username,
                    'X-User-token': storage.get('user').authentication_token,
                }
            })
            .then(function(response) {
                $scope.following = true;
                $(".follow").addClass('following');
            });
        }
    }

    $scope.unFollowUser = function() {
        $http.get('/api/ramona/unfollow.json', {
            headers: {
                'Content-Type': 'application/json',
                'X-User-username': storage.get('user').username,
                'X-User-token': storage.get('user').authentication_token,
            }
        })
        .then(function(response) {
            $scope.following = false;
            $(".follow").removeClass('following');
        });
    }

});
