tmj.controller('ProfileController', function($rootScope, $scope, $http, $sce, $compile, $routeParams, $location) {

    if (!storage.get('user')) {
        $location.path('/login');
    }
    $scope.loggedUser = storage.get('user');
    $scope.currentUser = {};

    console.log($routeParams.username);

    $http.get('/api/user/'+$routeParams.username+'/profile.json')
        .then(function(response) {
            $scope.currentUser.bio = response.data.bio;
            $scope.currentUser.username = response.data.username;
            $scope.currentUser.image = response.data.image;
            $scope.currentUser.providers = {};
            response.data.providers.forEach(function(p) {
                $scope.currentUser.providers[p.name] = p.username;
            });
            setTimeout(function() {
                $('.avatar').attr('src', $scope.currentUser.image);
            }, 1000);
        }, function(response) {
            window.location = '/';
        });

    // $http.get("/user/edit.json", {
    //         headers: {
    //             'Content-Type': 'application/json',
    //             'X-User-username': $scope.currentUser.username,
    //             'X-User-token': $scope.currentUser.authentication_token,
    //         }
    //     })
    //     .then(function(response) {
    //         $scope.currentUser.bio = response.data.bio;
    //         $scope.currentUser.username = response.data.username;
    //         $scope.currentUser.email = response.data.email;
    //         $scope.currentUser.image = response.data.image;
    //         $scope.currentUser.providers = {};
    //         response.data.providers.forEach(function(p) {
    //             $scope.currentUser.providers[p.name] = p.uid;
    //         });
    //         setTimeout(function() {
    //             $('.avatar').attr('src', $scope.currentUser.image);
    //         }, 1000);
    //         storage.set('user', $scope.user);
    //     });

    $rootScope.pageName = $scope.currentUser.username;
    $('body').addClass('profile');

    if (!isMobileDevice) {
        $('.cards').css({
            "width": "80%",
            "max-width": "1180px",
            "margin": "0 auto 50px auto",
            "padding": 0
        });
        $('html').css({ overflow: 'auto' });
    }

    var distanceTop = 0;

    $scope.swipeUp = function() {
        distanceTop = -$(window).height();
        $('.cards').each(function(i, e) {
            var top = parseInt($(this).css('top').replace('px'));
            if (i == 0 && top == (($('.cards').length - 1) * distanceTop)) {
                distanceTop = 0;
            }
            $(this).animate({ top: top + distanceTop }, 500, 'easeOutExpo');
        });
        setTimeout(function() {
            $rootScope.animateInitial();
        }, 1000);
        $rootScope.track('swipe', 'cards', 'up');
    }

});
